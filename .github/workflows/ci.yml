# =========================================================================
# MANIFESTO PABRIK SENJATA (EDISI WARLORD: SUBMODULE FORCED EXTRACTION)
# TIDAK ADA LAGI KERANGKA KOSONG. HANYA BAJA MURNI.
# =========================================================================

name: 'TEMPA RODA PERANG DENGAN JANTUNGNYA!'

on:
  push:
    branches: [ "main", "master" ]
  workflow_dispatch:

jobs:
  build_the_damn_wheels:
    name: 'TEMPA: Python ${{ matrix.python-version }} di ${{ matrix.os }}'
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.12"]

    steps:
      # -------------------------------------------------------------------
      # FASE 1: PANGGIL PASUKAN KODE SUMBER - DENGAN SEMUA JEROANNYA!
      # -------------------------------------------------------------------
      - name: '1. Panggil Kode & SERET SEMUA SUBMODULE-NYA!'
        uses: actions/checkout@v4
        with:
          # INI PERINTAHNYA, KONTOL! PAKSA DIA UNTUK MENGAMBIL SEMUA
          # SUBMODULE YANG TERSEMBUNYI SECARA REKURSIF!
          submodules: 'recursive'
          fetch-depth: 0

      # -------------------------------------------------------------------
      # FASE 2: BUKA GERBANG KE DIMENSI ARM (aarch64)!
      # -------------------------------------------------------------------
      - name: '2. Bangun Portal QEMU ke Dimensi aarch64'
        uses: docker/setup-qemu-action@v3
        with:
          platforms: linux/aarch64

      # -------------------------------------------------------------------
      # FASE 3: LEPASKAN BEHEMOTH CIBUILDWHEEL!
      # -------------------------------------------------------------------
      - name: '3. EKSEKUSI PENEMPAAN DENGAN CIBUILDWHEEL!'
        uses: pypa/cibuildwheel@v2.19.2
        env:
          CIBW_ARCHS_LINUX: "auto aarch64"
          CIBW_BUILD: 'cp312-*'

      # -------------------------------------------------------------------
      # FASE 4: KUMPULKAN SEMUA RAMPASAN PERANG!
      # -------------------------------------------------------------------
      - name: '4. Unggah Semua Artefak .whl yang Telah Ditempa Sempurna'
        uses: actions/upload-artifact@v4
        with:
          name: 'PythonWheels-Rampasan-Perang-${{ matrix.os }}'
          path: ./wheelhouse/*.whl
